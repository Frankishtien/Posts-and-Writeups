# content security policy


<details>
  <summary>Part one</summary>

[Post_link](https://www.linkedin.com/posts/daoud-youssef-yany_securityabrtipsabrwithabrdaoud-activity-7372375963604516864-bVW9/?utm_source=share&utm_medium=member_android&rcm=ACoAAEvbB6gBsfqHvlwzrauR1IimSlFa7C0L4ok)


بوست النهاردة عن حاجة ناس كتير مش بتاخد بالها منها ومش بيتكلموا عنها وهي CSP (content security policy)
ايه هي اصلا وبتستعمل في ايه وازاي نعملها تخطي
هي عبارة عن بوليسي يعني سياسة او قواعد بيقولها السيرفر للمتصفح علشان يمشي عليها بيحدد له فيها يحمل الموارد من فين والموارد دي تشمل الصور والفيديوهات والاسكربتات وملفات css - javascript 
وبيكون الغرض الاساسي منها تقليل ثغرة xss + clickjacking + data exfiltration
المكان بتاعها بيكون في مكانين اما في الهيدرز بتاعت الريسبونس ( الاكثر شيوعا) او في ميتا تاج في اول السورس كود بتاع الصفحة والسياسة او القواعد دي بتكون متقسمة لحاجات اسمها directive 
ودي كلمة معناها توجه بمعنى فيه توجه للصور وتوجه للاسكربتات وتوجه للiframe 
وهكذا وكل توجه من دول بيكون له قيم مختلفة بتحدد للمتصفح يسمح للموارد من النوع ده من انهو مصدر يعني مثلا بيكون قيمتها زي ما في الصورة كدة دي جزء من البوليسي بتاعت تويتر اللي باللون الازرق ده اسم التوجه واللي باللون الاحمر دي قيم مختلفة لنفس التوجه بتفصل بين كل قيمة والتانية مسافة وطبعا بتتضمن ان المصادر دي تكون دومينات معينة او حتى صب دومين واحد من دومين معين زي ما هو واضح في الصورة 
يعني مثلا لو اخدنا قيمة script-src 
هتلاقي قيم مثلا كالتالي 
self: يعني تنفذ اسكربتات من نفس الاورجن ( بروتوكول + دومين + بورت)
unsafe-eval: يسمح بتشغيل الفانكشن الخطيرة اللي زي eval - settimeout - Function
nonce: دي عبارة عن ان السيرفر بيضيف قيمة عشوائية متغيرة لكل يوزر في الهيدر وفي نفس الوقت بيحطها كقيمة في اسكربت الجافا اسكريبت وبالتالي انا باقول للمتصفح متشغلش غير الفانكشن اللي في الملف ده 
hash: ده بيشغل اسكربتات لما يكون الهاش بتاعها رقم معين بس ده مش مستحب من الديفولبر علشان بيخلي المتصفح يحسب الهاش بتاعت كل ملف قبل ما يشغله وممكن يسبب عطل في التشغيل او تاخير في التشغيل وبيميلوا اكتر لل nonce 
blob: تسمح بتشغيل اسكربتات من نوع blob/data
وفيه قيم تاني بس دول الاشهر 
فيه توجه معين اسمه default-src 
ده المتصفح بيرجع له لما يكون مفيش قيمة لاي توجه تاني هو محتاج يعرفه يعني مثلا مفيش توجه للصور لو ملقيش بيرجع للتوجه ده يشوف ايه القيم المسموحة فيه يطبقها على الصور 
الاصل في السياسة دي هي الاباحة والاستثناء هو المنع يعني اي حاجة مش بتتمنع فالاصل فيها هو السماح بس طبعا اخذا في الاعتبار قيود المتصفح نفسه
لو لقيت في البوليسي دي script-src: unsafe-inline
اعرف ان اي xss هتلاقيها اشطة هتبقى شغالة بدون عوائق 
لو الموقع في السياسة بتاعته بيسمح بتحميل مصادر من دومينات معينة شوف وسط الدومينات دي لو فيه حاجة تقدر تعمل فيها صب دومين وترفع عليه محتوى ملف جافا اسكريبت هتشتغل زي السكينة في الحلاوة 
جوجل عاملة موقع اسمه CSP Evaluator بتديله لينك الموقع او البوليسي نفسها وهو بيقولك ايه نقاط الضعف والقوة في البوليسي دي 
فيه هيدر في الريسبونس اسمه Content-Security-Policy-Report-Only لو لقيته لوحده من غير الهيدر بتاع البوليسي اللي اتكلمنا عليه فوق هتلاقيه بنفس قيم الهيدر العادي لكنه في الحالة دي هو بس بيبلغ الكسر بتاع البوليسي لكن بينفذ الكود عادي يعني مش بيمنع اي حاجة عكس البوليسي لكنه بيبلغ عنها فقط وده بيستخدموه الديفولبر في المرحلة التجريبية لبوليسي معينة بتكون صارمة وخايفين تكسر التشغيل فبيفعلوه الاول وبعدين لو لقيوه تمام بيشغلوا البوليسي عادي 
واخيرا لو استفدت حاجة من البوست متنسانيش بدعوة حلوة 
hashtag#security_tips_with_daoud






  
</details>








